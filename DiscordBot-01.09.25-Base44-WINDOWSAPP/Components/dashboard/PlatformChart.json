import React from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { BarChart, Bar, XAxis, YAxis, ResponsiveContainer } from "recharts";
import { Skeleton } from "@/components/ui/skeleton";

const COLORS = {
  "PS Plus": "#3b82f6",
  "Xbox Game Pass": "#22c55e", 
  "Prime Gaming": "#a855f7",
  "Multiple": "#f97316"
};

export default function PlatformChart({ games, isLoading }) {
  const getPlatformData = () => {
    const platforms = {};
    games.forEach(game => {
      platforms[game.piattaforma] = (platforms[game.piattaforma] || 0) + 1;
    });
    
    return Object.entries(platforms).map(([name, value]) => ({ name, value, fill: COLORS[name] || "#f97316" }));
  };

  const data = getPlatformData();

  return (
    <Card className="bg-card">
      <CardHeader>
        <CardTitle>Giochi per Piattaforma</CardTitle>
      </CardHeader>
      <CardContent>
        {isLoading ? (
           <Skeleton className="h-[250px] w-full" />
        ) : (
          <div className="h-[250px]">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={data} layout="vertical" margin={{ left: 10, right: 10 }}>
                <XAxis type="number" hide />
                <YAxis 
                  dataKey="name" 
                  type="category" 
                  tickLine={false}
                  axisLine={false}
                  tick={{ fill: 'hsl(var(--muted-foreground))', fontSize: 12 }}
                  width={90}
                />
                <Bar 
                  dataKey="value" 
                  radius={[0, 4, 4, 0]}
                  background={{ fill: 'hsl(var(--secondary))', radius: 4 }}
                />
              </BarChart>
            </ResponsiveContainer>
          </div>
        )}
      </CardContent>
    </Card>
  );
}